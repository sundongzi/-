<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vuePress搭建项目及其自动部署 | DongZi’s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/daily-summary/assets/css/0.styles.1f120a4b.css" as="style"><link rel="preload" href="/daily-summary/assets/js/app.30ad671e.js" as="script"><link rel="preload" href="/daily-summary/assets/js/2.e3724b2f.js" as="script"><link rel="preload" href="/daily-summary/assets/js/45.15aa9797.js" as="script"><link rel="prefetch" href="/daily-summary/assets/js/10.46e8eda2.js"><link rel="prefetch" href="/daily-summary/assets/js/11.322df6b4.js"><link rel="prefetch" href="/daily-summary/assets/js/12.4cb779b3.js"><link rel="prefetch" href="/daily-summary/assets/js/13.0e1b1f4d.js"><link rel="prefetch" href="/daily-summary/assets/js/14.3afbb547.js"><link rel="prefetch" href="/daily-summary/assets/js/15.c0674a10.js"><link rel="prefetch" href="/daily-summary/assets/js/16.3c772999.js"><link rel="prefetch" href="/daily-summary/assets/js/17.813ea93f.js"><link rel="prefetch" href="/daily-summary/assets/js/18.08f95070.js"><link rel="prefetch" href="/daily-summary/assets/js/19.f8fd085f.js"><link rel="prefetch" href="/daily-summary/assets/js/20.99af95b0.js"><link rel="prefetch" href="/daily-summary/assets/js/21.04a772b9.js"><link rel="prefetch" href="/daily-summary/assets/js/22.7a771fd7.js"><link rel="prefetch" href="/daily-summary/assets/js/23.30cf2412.js"><link rel="prefetch" href="/daily-summary/assets/js/24.6f51ee39.js"><link rel="prefetch" href="/daily-summary/assets/js/25.ac227ad7.js"><link rel="prefetch" href="/daily-summary/assets/js/26.ee3b8296.js"><link rel="prefetch" href="/daily-summary/assets/js/27.ee7fc772.js"><link rel="prefetch" href="/daily-summary/assets/js/28.8067dcc6.js"><link rel="prefetch" href="/daily-summary/assets/js/29.1f41e63b.js"><link rel="prefetch" href="/daily-summary/assets/js/3.bdb44b40.js"><link rel="prefetch" href="/daily-summary/assets/js/30.4272d7e9.js"><link rel="prefetch" href="/daily-summary/assets/js/31.302d2d76.js"><link rel="prefetch" href="/daily-summary/assets/js/32.f1fc0ee4.js"><link rel="prefetch" href="/daily-summary/assets/js/33.aaaec983.js"><link rel="prefetch" href="/daily-summary/assets/js/34.1a27ec46.js"><link rel="prefetch" href="/daily-summary/assets/js/35.72c1d376.js"><link rel="prefetch" href="/daily-summary/assets/js/36.5d2adddf.js"><link rel="prefetch" href="/daily-summary/assets/js/37.59c0ea87.js"><link rel="prefetch" href="/daily-summary/assets/js/38.0665771d.js"><link rel="prefetch" href="/daily-summary/assets/js/39.ee944f04.js"><link rel="prefetch" href="/daily-summary/assets/js/4.e05c873c.js"><link rel="prefetch" href="/daily-summary/assets/js/40.0b0da924.js"><link rel="prefetch" href="/daily-summary/assets/js/41.a009d456.js"><link rel="prefetch" href="/daily-summary/assets/js/42.1fa6e1b4.js"><link rel="prefetch" href="/daily-summary/assets/js/43.1e90a95a.js"><link rel="prefetch" href="/daily-summary/assets/js/44.b2a074bb.js"><link rel="prefetch" href="/daily-summary/assets/js/46.66dc609a.js"><link rel="prefetch" href="/daily-summary/assets/js/47.c217451d.js"><link rel="prefetch" href="/daily-summary/assets/js/48.cd5506c2.js"><link rel="prefetch" href="/daily-summary/assets/js/49.904879e6.js"><link rel="prefetch" href="/daily-summary/assets/js/5.76fc70b2.js"><link rel="prefetch" href="/daily-summary/assets/js/50.d5481e8b.js"><link rel="prefetch" href="/daily-summary/assets/js/51.f5cff90c.js"><link rel="prefetch" href="/daily-summary/assets/js/52.242e7a1b.js"><link rel="prefetch" href="/daily-summary/assets/js/53.408cd71b.js"><link rel="prefetch" href="/daily-summary/assets/js/54.f6e2998f.js"><link rel="prefetch" href="/daily-summary/assets/js/55.17f94413.js"><link rel="prefetch" href="/daily-summary/assets/js/56.2e9dca38.js"><link rel="prefetch" href="/daily-summary/assets/js/57.8cfa9c0f.js"><link rel="prefetch" href="/daily-summary/assets/js/58.d79d3015.js"><link rel="prefetch" href="/daily-summary/assets/js/59.037e7cf4.js"><link rel="prefetch" href="/daily-summary/assets/js/6.498ab014.js"><link rel="prefetch" href="/daily-summary/assets/js/60.79c1639f.js"><link rel="prefetch" href="/daily-summary/assets/js/61.54437e1f.js"><link rel="prefetch" href="/daily-summary/assets/js/62.640c7eda.js"><link rel="prefetch" href="/daily-summary/assets/js/63.43c3e240.js"><link rel="prefetch" href="/daily-summary/assets/js/64.171f1ef1.js"><link rel="prefetch" href="/daily-summary/assets/js/65.18b38ebc.js"><link rel="prefetch" href="/daily-summary/assets/js/66.2e5544e3.js"><link rel="prefetch" href="/daily-summary/assets/js/7.7c4499b7.js"><link rel="prefetch" href="/daily-summary/assets/js/8.f37556b9.js"><link rel="prefetch" href="/daily-summary/assets/js/9.45fe3c95.js">
    <link rel="stylesheet" href="/daily-summary/assets/css/0.styles.1f120a4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/daily-summary/" class="home-link router-link-active"><!----> <span class="site-name">DongZi’s blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/daily-summary/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/daily-summary/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/daily-summary/页面/" class="nav-link">
  页面
</a></div><div class="nav-item"><a href="/daily-summary/Git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/daily-summary/项目积累/" class="nav-link">
  项目积累
</a></div><div class="nav-item"><a href="/daily-summary/更多/" class="nav-link">
  更多
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/daily-summary/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/daily-summary/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/daily-summary/页面/" class="nav-link">
  页面
</a></div><div class="nav-item"><a href="/daily-summary/Git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/daily-summary/项目积累/" class="nav-link">
  项目积累
</a></div><div class="nav-item"><a href="/daily-summary/更多/" class="nav-link">
  更多
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/daily-summary/更多/canvas.html" class="sidebar-link">canvas</a></li><li><a href="/daily-summary/更多/chrome-extension.html" class="sidebar-link">chrome-extension</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/daily-summary/更多/promise.html" class="sidebar-link">promise</a></li><li><a href="/daily-summary/更多/你不知道的javascript(上).html" class="sidebar-link">你不知道的javascript(上)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/daily-summary/更多/关于回调的一些理解.html" class="sidebar-link">关于回调的一些理解</a></li><li><a href="/daily-summary/更多/前后端分离.html" class="sidebar-link">前后端分离</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/daily-summary/更多/单点登录.html" class="sidebar-link">单点登录</a></li><li><a href="/daily-summary/更多/原型到原型链.html" class="sidebar-link">原型到原型链</a></li><li><a href="/daily-summary/更多/数字格式化.html" class="sidebar-link">数字格式化</a></li><li><a href="/daily-summary/更多/求多个数组之间的交集.html" class="sidebar-link">求多个数组之间的交集</a></li><li><a href="/daily-summary/更多/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/daily-summary/更多/类型检测方法总结.html" class="sidebar-link">类型检测方法总结</a></li><li><a href="/daily-summary/更多/节流与防抖.html" class="sidebar-link">节流与防抖</a></li><li><a href="/daily-summary/更多/Vuepress搭建静态博客.html" class="active sidebar-link">Vuepress搭建静态博客</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="vuepress搭建项目及其自动部署"><a href="#vuepress搭建项目及其自动部署" class="header-anchor">#</a> vuePress搭建项目及其自动部署</h3> <p>![image-20210422165446955](/Users/sundong/Library/Application Support/typora-user-images/image-20210422165446955.png)</p> <h4 id="vuepress"><a href="#vuepress" class="header-anchor">#</a> VuePress</h4> <p><code>VuePress</code>由两部分组成：一部分是支持用 Vue 开发主题的极简静态网站生成器，另一个部分是为书写技术文档而优化的默认主题。它的诞生初衷是为了支持 Vue 及其子项目的文档需求。<code>VuePress</code>能在<code>Markdown</code>里使用Vue语法，并且每个页面都会预渲染生成静态的<code>HTML</code>，也就是说加载性能好还有非常好的SEO支持，适合用来写文档和博客。</p> <h5 id="一、项目搭建"><a href="#一、项目搭建" class="header-anchor">#</a> 一、项目搭建</h5> <ol><li><p>依赖安装</p> <ul><li><p>全局安装：如果你只是想单纯的尝试一下<code>vuePress</code>的话，可以全局进行安装</p></li> <li><p>现有项目安装：如果想在现有项目中使用<code>vuePress</code>的话，则应该将其安装在本地依赖中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>全局安装
yarn global add vuepress # 或者：npm install <span class="token operator">-</span>g vuepress

现有项目安装
yarn add <span class="token operator">-</span><span class="token constant">D</span> vuepress # 或者：npm install <span class="token operator">-</span><span class="token constant">D</span> vuepress
</code></pre></div></li></ul></li> <li><p>在<code>package.json</code>中添加一些脚本</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;docs:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vuepress dev docs&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;docs:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vuepress build docs&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h5 id="二、基本配置"><a href="#二、基本配置" class="header-anchor">#</a> 二、基本配置</h5> <ol><li><p>基本项目结构</p> <p>![image-20210417100349355](/Users/sundong/Library/Application Support/typora-user-images/image-20210417100349355.png)</p></li> <li><p>必要的配置文件<code>.vuepress/config.js</code>，它导出的是一个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> themeConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config/index'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   lang<span class="token operator">:</span> <span class="token string">'zh-CN'</span><span class="token punctuation">,</span>
   title<span class="token operator">:</span> <span class="token string">'DongZi’s blog'</span><span class="token punctuation">,</span>
   base<span class="token operator">:</span> <span class="token string">'/daily-summary/'</span><span class="token punctuation">,</span>
   serviceWorker<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   themeConfig
<span class="token punctuation">}</span>
</code></pre></div><p><code>VuePress</code>还有很多扩展的配置，在<code>docs</code>目录下加新建<code>.vuepress/config.js</code>，在这里可以配置标题、主题、语言、导航栏、侧边栏等等，在这里不展开描述。具体请参考 <a href="https://v0.vuepress.vuejs.org/zh/config/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">vuepress基本配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>项目本地启动</p> <div class="language-js extra-class"><pre class="language-js"><code>yarn docs<span class="token operator">:</span>dev # 或者：npm run docs<span class="token operator">:</span>dev
</code></pre></div><p>然后就可以打开<code>localhost:8080</code>看到相关的文章了，并且是支持热更新，因为<code>vuepress</code>就是用<code>webpack-dev-server</code>驱动的。</p> <p>最后部署的时候用<code>yarn docs:build</code>命令，会在<code>docs/.vuepress</code>生成dist目录，这个目录后面配置workflow会用到。</p></li></ol> <h4 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h4> <p>说了这么多都是在本地进行的，现在我们要把本地的内容推送到某个服务器上，这样只要有网络，就可以随时随地看自己的网站了。一般来说有两种方案可以选择</p> <ol><li>自己买一个服务器，比如什么阿里云、腾讯云等，这种方式的好处是速度有保证，可以被搜索引擎收录</li> <li>使用<a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">Github pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。什么是 Github Pages 呢？简单说就是 Github 提供的、用于搭建个人网站的静态站点托管服务。</li></ol> <h5 id="使用github-pages搭建网站"><a href="#使用github-pages搭建网站" class="header-anchor">#</a> 使用Github Pages搭建网站</h5> <ol><li>个人站点
<ul><li>创建个人站点，新建仓库（<strong>注：<strong>仓库名必须是</strong>用户名.github.io</strong>）</li> <li>在仓库下新建<code>index.html</code>的文件即可（里面随便写点内容）注意：<code>Github Pages</code>仅支持静态网页</li></ul></li> <li>项目站点
<ul><li>进入项目主页，点击<code>settings</code></li> <li>找到<code>Pages</code>，进行站点基础信息设置</li> <li>选择主题（可选）</li> <li>生成网页（可选）</li></ul></li></ol> <h5 id="使用github-actions进行部署"><a href="#使用github-actions进行部署" class="header-anchor">#</a> 使用Github-actions进行部署</h5> <p>简介：actions顾名思义就是一堆动作，是一个持续集成服务，持续集成包含了拉代码、运行测试、编译代码、登录远程服务器，发布到第三方服务等等的操作，GitHub将这些操作称为actions。</p> <p>不同项目的很多操作可以是一样的，比如拉取分支代码、缓存依赖等，每个也就是一个action脚本是可以共用的，所以GitHub允许开发者把每个操作写成独立的脚本文件，存放到代码仓库，使得其他开发者可以引用。</p> <ol><li><p>仓库地址设置（非必须）</p> <p>经过<code>Github Pages</code>创建仓库后，如果建立的仓库名称是username.github.io，则最后访问的地址<a href="https://username.github.io/%E3%80%82" target="_blank" rel="noopener noreferrer">username.github.io/。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 如果不是这个名称，则最后访问的地址是<a href="https://username.github.io/repo/" target="_blank" rel="noopener noreferrer">username.github.io/repo/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ,repo就是仓库名字，此时还需要先修改<code>.vuepress/config.js</code>，该文件导出一个对象，增加base的配置项，值为“/repo/”。</p> <p>以下是我本地的配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   lang<span class="token operator">:</span> <span class="token string">'zh-CN'</span><span class="token punctuation">,</span>
   title<span class="token operator">:</span> <span class="token string">'DongZi’s blog'</span><span class="token punctuation">,</span>
   base<span class="token operator">:</span> <span class="token string">'/daily-summary/'</span><span class="token punctuation">,</span>  <span class="token comment">// 注意此处的值应当总是以斜杠开始，并以斜杠结束。</span>
   serviceWorker<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   themeConfig
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>添加.github相关配置文件</p> <p>在项目的根目录下新建<code>.github/workflows</code>目录，<code>workflows</code>就是<code>GitHub Actions</code> 的配置文件。随便新建.yml文件就是一个flow，<code>github</code>会自动运行<code>workflows</code>目录下所有的yml文件。介绍下workflow最重要的几个配置和概念。</p> <ul><li><p>name</p> <p>name字段是 workflow 的名称。如果省略该字段，默认为当前 workflow 的文件名</p></li> <li><p>on</p> <p>on字段指定触发 workflow 的条件，通常是某些事件。我在项目中用的是push，指的就是当git push事件发生时触发该workflow</p></li> <li><p>jobs</p> <p>jobs是workflow最重要的部分，表示workflow要执行的任务，可以是一个或者多个</p></li></ul> <p>项目中我希望的流程是，本地改完代码以后，上传到github后能自动打包部署到<code>gh-pages</code>分支。<code>gh-pages</code> 分支，是 GitHub Pages 服务的固定分支，可以通过 HTTP 的方式访问到这个分支的静态文件资源</p> <p>配置触发条件on：</p> <div class="language-js extra-class"><pre class="language-js"><code>on<span class="token operator">:</span> # 触发条件
  # 每当 push 到 master 分支时触发部署
  push<span class="token operator">:</span>
    branches<span class="token operator">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
  # 是否手动触发部署
  workflow_dispatch<span class="token operator">:</span>
</code></pre></div><p>接下来就是jobs：</p> <div class="language-js extra-class"><pre class="language-js"><code>name<span class="token operator">:</span> docs # workflow名称

on<span class="token operator">:</span> # 触发条件
  # 每当 push 到 master 分支时触发部署
  push<span class="token operator">:</span>
    branches<span class="token operator">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
  # 是否手动触发部署
  workflow_dispatch<span class="token operator">:</span>

jobs<span class="token operator">:</span>
  docs<span class="token operator">:</span>
    runs<span class="token operator">-</span>on<span class="token operator">:</span> ubuntu<span class="token operator">-</span>latest # 指定运行所需要的虚拟机环境（必填）

    steps<span class="token operator">:</span>
      <span class="token operator">-</span> uses<span class="token operator">:</span> actions<span class="token operator">/</span>checkout@v2
        <span class="token keyword">with</span><span class="token operator">:</span>
          # “最近更新时间” 等 git 日志相关信息，需要拉取全部提交记录
          fetch<span class="token operator">-</span>depth<span class="token operator">:</span> <span class="token number">0</span>

      <span class="token operator">-</span> name<span class="token operator">:</span> Setup Node<span class="token punctuation">.</span>js
        uses<span class="token operator">:</span> actions<span class="token operator">/</span>setup<span class="token operator">-</span>node@v1
        <span class="token keyword">with</span><span class="token operator">:</span>
          # 选择要使用的 node 版本
          node<span class="token operator">-</span>version<span class="token operator">:</span> <span class="token string">&quot;14&quot;</span>

      # 缓存 node_modules
      <span class="token operator">-</span> name<span class="token operator">:</span> Cache dependencies
        uses<span class="token operator">:</span> actions<span class="token operator">/</span>cache@v2
        id<span class="token operator">:</span> yarn<span class="token operator">-</span>cache
        <span class="token keyword">with</span><span class="token operator">:</span>
          path<span class="token operator">:</span> <span class="token operator">|</span>
            <span class="token operator">**</span><span class="token operator">/</span>node_modules
          key<span class="token operator">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner<span class="token punctuation">.</span>os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">-</span>yarn<span class="token operator">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">hashFiles</span><span class="token punctuation">(</span><span class="token string">'**/yarn.lock'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          restore<span class="token operator">-</span>keys<span class="token operator">:</span> <span class="token operator">|</span>
            $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner<span class="token punctuation">.</span>os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">-</span>yarn<span class="token operator">-</span>
      # 如果缓存没有命中，安装依赖
      <span class="token operator">-</span> name<span class="token operator">:</span> Install dependencies
        <span class="token keyword">if</span><span class="token operator">:</span> steps<span class="token punctuation">.</span>yarn<span class="token operator">-</span>cache<span class="token punctuation">.</span>outputs<span class="token punctuation">.</span>cache<span class="token operator">-</span>hit <span class="token operator">!=</span> <span class="token string">'true'</span>
        run<span class="token operator">:</span> yarn <span class="token operator">--</span>frozen<span class="token operator">-</span>lockfile  <span class="token comment">// 锁定版本</span>

      # 运行构建脚本
      <span class="token operator">-</span> name<span class="token operator">:</span> Build VuePress site
        run<span class="token operator">:</span> yarn docs<span class="token operator">:</span>build

      # 查看 workflow 的文档来获取更多信息
      # @see https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>crazy<span class="token operator">-</span>max<span class="token operator">/</span>ghaction<span class="token operator">-</span>github<span class="token operator">-</span>pages
      <span class="token operator">-</span> name<span class="token operator">:</span> Deploy to GitHub Pages
        uses<span class="token operator">:</span> JamesIves<span class="token operator">/</span>github<span class="token operator">-</span>pages<span class="token operator">-</span>deploy<span class="token operator">-</span>action@<span class="token number">4.1</span><span class="token number">.0</span>
        <span class="token keyword">with</span><span class="token operator">:</span>
          # 部署到 gh<span class="token operator">-</span>pages 分支
          <span class="token constant">BRANCH</span><span class="token operator">:</span> gh<span class="token operator">-</span>pages
          # 部署目录为 VuePress 的默认输出目录
          <span class="token constant">FOLDER</span><span class="token operator">:</span> docs<span class="token operator">/</span><span class="token punctuation">.</span>vuepress<span class="token operator">/</span>dist
          <span class="token constant">ACCESS_TOKEN</span><span class="token operator">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets<span class="token punctuation">.</span><span class="token constant">ACTION_SECRETS</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment">// 秘钥</span>
</code></pre></div><p>首先job里配置运行这个脚本需要的虚拟机环境，这个虚拟机环境由github提供，可用的包括windows、linux、macos等环境。在此示例中其实不论哪个系统都是可以的，因为我们需要的是node环境，而node本身就是跨平台的。</p> <p>接下里设置获取源码、需要的node版本、增加缓存依赖，这里使用官方提供的actions/setup-node@v1、setup-node@v1、cache@v2。这里的@表示版本，使用别人的action时最好都加上版本，以防后面更新的action不兼容当前的脚本。Github官方的actions都放在<a href="https://github.com/actions" target="_blank" rel="noopener noreferrer">github.com/actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>仓库中。这些前置条件配置好，接下来就是熟悉的yarn install、yarn docs:build，安装依赖使用--frozen-lockfile来锁定版本。最后一步就是将打包的目录更新到<code>gh-pages</code>分支。因为要更新github代码，所以还需要配置<code>github-token</code>。</p> <h5 id="创建github-token"><a href="#创建github-token" class="header-anchor">#</a> 创建<code>Github Token</code></h5> <p>创建一个有<code>repo</code>和<code>workflow</code>权限的<a href="https://github.com/settings/tokens/new" target="_blank" rel="noopener noreferrer">Github Token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。创建成功后把生成的<code>token</code>只会显示一次，把它保存起来。</p> <p>![image-20210422144051946](/Users/sundong/Library/Application Support/typora-user-images/image-20210422144051946.png)</p> <h5 id="添加secret"><a href="#添加secret" class="header-anchor">#</a> 添加secret</h5> <p>在仓库的setting下找到secert，新建一个secert并将上面新创建的<code>Token</code>添加到value里面，然后名字可以随便取，这里取为ACTION_SECERTS。在workflow的环境变量里secerts指的就是这里secert</p> <p>![image-20210422144521848](/Users/sundong/Library/Application Support/typora-user-images/image-20210422144521848.png)</p></li></ol> <p>最后指定部署的分支名称，和部署到分支的默认输出目录就行。</p> <p>尝试着push推送代码，可以看到仓库的Actions开始自动运行了，并且能看到运行的日志。如果运行错误，可以查看具体错误原因。</p> <p>![image-20210417103636679](/Users/sundong/Library/Application Support/typora-user-images/image-20210417103636679.png)</p> <h4 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接：</h4> <p><a href="https://zhuanlan.zhihu.com/p/76505295" target="_blank" rel="noopener noreferrer">Github Pages搭建网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6937532951223599141" target="_blank" rel="noopener noreferrer">Github Action自动化部署<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="感谢聆听"><a href="#感谢聆听" class="header-anchor">#</a> 感谢聆听~</h4></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daily-summary/更多/节流与防抖.html" class="prev">
        节流与防抖
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/daily-summary/assets/js/app.30ad671e.js" defer></script><script src="/daily-summary/assets/js/2.e3724b2f.js" defer></script><script src="/daily-summary/assets/js/45.15aa9797.js" defer></script>
  </body>
</html>
