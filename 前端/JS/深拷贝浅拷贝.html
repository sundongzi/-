<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深拷贝 VS 浅拷贝 | DongZi’s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/daily-summary/assets/css/0.styles.1f120a4b.css" as="style"><link rel="preload" href="/daily-summary/assets/js/app.ce6a5f7d.js" as="script"><link rel="preload" href="/daily-summary/assets/js/2.e3724b2f.js" as="script"><link rel="preload" href="/daily-summary/assets/js/21.04a772b9.js" as="script"><link rel="prefetch" href="/daily-summary/assets/js/10.46e8eda2.js"><link rel="prefetch" href="/daily-summary/assets/js/11.322df6b4.js"><link rel="prefetch" href="/daily-summary/assets/js/12.4cb779b3.js"><link rel="prefetch" href="/daily-summary/assets/js/13.0e1b1f4d.js"><link rel="prefetch" href="/daily-summary/assets/js/14.3afbb547.js"><link rel="prefetch" href="/daily-summary/assets/js/15.c0674a10.js"><link rel="prefetch" href="/daily-summary/assets/js/16.3c772999.js"><link rel="prefetch" href="/daily-summary/assets/js/17.813ea93f.js"><link rel="prefetch" href="/daily-summary/assets/js/18.08f95070.js"><link rel="prefetch" href="/daily-summary/assets/js/19.f8fd085f.js"><link rel="prefetch" href="/daily-summary/assets/js/20.99af95b0.js"><link rel="prefetch" href="/daily-summary/assets/js/22.7a771fd7.js"><link rel="prefetch" href="/daily-summary/assets/js/23.30cf2412.js"><link rel="prefetch" href="/daily-summary/assets/js/24.6f51ee39.js"><link rel="prefetch" href="/daily-summary/assets/js/25.ac227ad7.js"><link rel="prefetch" href="/daily-summary/assets/js/26.ee3b8296.js"><link rel="prefetch" href="/daily-summary/assets/js/27.ee7fc772.js"><link rel="prefetch" href="/daily-summary/assets/js/28.8067dcc6.js"><link rel="prefetch" href="/daily-summary/assets/js/29.1f41e63b.js"><link rel="prefetch" href="/daily-summary/assets/js/3.122e0a11.js"><link rel="prefetch" href="/daily-summary/assets/js/30.4272d7e9.js"><link rel="prefetch" href="/daily-summary/assets/js/31.302d2d76.js"><link rel="prefetch" href="/daily-summary/assets/js/32.f1fc0ee4.js"><link rel="prefetch" href="/daily-summary/assets/js/33.aaaec983.js"><link rel="prefetch" href="/daily-summary/assets/js/34.1a27ec46.js"><link rel="prefetch" href="/daily-summary/assets/js/35.72c1d376.js"><link rel="prefetch" href="/daily-summary/assets/js/36.5d2adddf.js"><link rel="prefetch" href="/daily-summary/assets/js/37.59c0ea87.js"><link rel="prefetch" href="/daily-summary/assets/js/38.0665771d.js"><link rel="prefetch" href="/daily-summary/assets/js/39.ee944f04.js"><link rel="prefetch" href="/daily-summary/assets/js/4.e05c873c.js"><link rel="prefetch" href="/daily-summary/assets/js/40.0b0da924.js"><link rel="prefetch" href="/daily-summary/assets/js/41.5cd18017.js"><link rel="prefetch" href="/daily-summary/assets/js/42.251afbe7.js"><link rel="prefetch" href="/daily-summary/assets/js/43.b17d7f13.js"><link rel="prefetch" href="/daily-summary/assets/js/44.ed865300.js"><link rel="prefetch" href="/daily-summary/assets/js/45.3e3c81e7.js"><link rel="prefetch" href="/daily-summary/assets/js/46.bb2b1728.js"><link rel="prefetch" href="/daily-summary/assets/js/47.41862294.js"><link rel="prefetch" href="/daily-summary/assets/js/48.9bce0669.js"><link rel="prefetch" href="/daily-summary/assets/js/49.c0dc035e.js"><link rel="prefetch" href="/daily-summary/assets/js/5.76fc70b2.js"><link rel="prefetch" href="/daily-summary/assets/js/50.724d44d1.js"><link rel="prefetch" href="/daily-summary/assets/js/51.4a446026.js"><link rel="prefetch" href="/daily-summary/assets/js/52.a9b0aca9.js"><link rel="prefetch" href="/daily-summary/assets/js/53.8ab3ac84.js"><link rel="prefetch" href="/daily-summary/assets/js/54.0946230f.js"><link rel="prefetch" href="/daily-summary/assets/js/55.fa0df2c2.js"><link rel="prefetch" href="/daily-summary/assets/js/56.c140c243.js"><link rel="prefetch" href="/daily-summary/assets/js/57.96b03c56.js"><link rel="prefetch" href="/daily-summary/assets/js/58.954f9b00.js"><link rel="prefetch" href="/daily-summary/assets/js/59.47d71bba.js"><link rel="prefetch" href="/daily-summary/assets/js/6.498ab014.js"><link rel="prefetch" href="/daily-summary/assets/js/60.a1825a73.js"><link rel="prefetch" href="/daily-summary/assets/js/61.2db1d5ff.js"><link rel="prefetch" href="/daily-summary/assets/js/62.309d8503.js"><link rel="prefetch" href="/daily-summary/assets/js/63.04b5beea.js"><link rel="prefetch" href="/daily-summary/assets/js/64.deca6bf5.js"><link rel="prefetch" href="/daily-summary/assets/js/7.7c4499b7.js"><link rel="prefetch" href="/daily-summary/assets/js/8.f37556b9.js"><link rel="prefetch" href="/daily-summary/assets/js/9.45fe3c95.js">
    <link rel="stylesheet" href="/daily-summary/assets/css/0.styles.1f120a4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/daily-summary/" class="home-link router-link-active"><!----> <span class="site-name">DongZi’s blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/daily-summary/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/daily-summary/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/daily-summary/页面/" class="nav-link">
  页面
</a></div><div class="nav-item"><a href="/daily-summary/Git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/daily-summary/项目积累/" class="nav-link">
  项目积累
</a></div><div class="nav-item"><a href="/daily-summary/更多/" class="nav-link">
  更多
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/daily-summary/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/daily-summary/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/daily-summary/页面/" class="nav-link">
  页面
</a></div><div class="nav-item"><a href="/daily-summary/Git/" class="nav-link">
  Git
</a></div><div class="nav-item"><a href="/daily-summary/项目积累/" class="nav-link">
  项目积累
</a></div><div class="nav-item"><a href="/daily-summary/更多/" class="nav-link">
  更多
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>安全相关</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daily-summary/前端/安全相关/CSRF攻击.html" class="sidebar-link">CSRF攻击</a></li><li><a href="/daily-summary/前端/安全相关/XSS攻击.html" class="sidebar-link">XSS攻击</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>闭包</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Es6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Immutable</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vscode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="深拷贝-vs-浅拷贝"><a href="#深拷贝-vs-浅拷贝" class="header-anchor">#</a> 深拷贝 VS 浅拷贝</h3> <h5 id="深拷贝和浅拷贝都是针对的引用类型-js中的变量类型分为值类型-基本类型-和引用类型-对值类型进行复制操作会对值进行一份拷贝-而对引用类型赋值-则会进行地址的拷贝-最终两个变量指向同一份数据"><a href="#深拷贝和浅拷贝都是针对的引用类型-js中的变量类型分为值类型-基本类型-和引用类型-对值类型进行复制操作会对值进行一份拷贝-而对引用类型赋值-则会进行地址的拷贝-最终两个变量指向同一份数据" class="header-anchor">#</a> 深拷贝和浅拷贝<u>都是针对的引用类型</u>，JS中的变量类型分为值类型（基本类型）和引用类型；对值类型进行复制操作会对值进行一份拷贝，而对引用类型赋值，则会进行地址的拷贝，最终两个变量指向同一份数据.</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 基本类型：基本数据类型可以直接访问，按照值进行分配的，存放在栈(stack)内存中的简单数据段，数据大小确定，内存空间大小可以分配   ps:当前执行环境结束时销毁</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a
a <span class="token operator">=</span> <span class="token number">2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment">// 2, 1</span>
<span class="token comment">// 引用类型：即存放在堆(heap)内存中的对象，变量实际保存的是一个指针，这个指针指向另一个位置  ps:不会随执行环境结束而销毁，只有当所有引用它的变量不存在时这个对象才被垃圾回收机制回收。</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'bangbang'</span><span class="token punctuation">,</span>age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> obj1<span class="token punctuation">.</span>age<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//bangbang</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//18</span>
<span class="token comment">//改变b和c的值</span>
b<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'sd'</span><span class="token punctuation">;</span>
c <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//sd</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//18</span>

</code></pre></div><h4 id="浅拷贝"><a href="#浅拷贝" class="header-anchor">#</a> 浅拷贝：</h4> <div class="language-Javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fatherObj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span>
<span class="token comment">// 最简单的浅拷贝方式</span>
<span class="token keyword">function</span> <span class="token function">shallowClone</span> <span class="token punctuation">(</span><span class="token parameter">fatherObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> childObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> fatherObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    childObj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> fatherObj<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> childObj
<span class="token punctuation">}</span>

<span class="token keyword">var</span> newChild <span class="token operator">=</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span>fatherObj<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newChild<span class="token punctuation">)</span> <span class="token comment">// {name:'zhangsan', age:18}</span>
newChild<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'lisi'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fatherObj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// zhangsan</span>

<span class="token keyword">var</span> parentObj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> age<span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span> hobby<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'girlfriend'</span><span class="token punctuation">,</span> <span class="token string">'money'</span><span class="token punctuation">,</span> <span class="token string">'house'</span><span class="token punctuation">,</span> <span class="token string">'car'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> newChild1 <span class="token operator">=</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span>parentObj<span class="token punctuation">)</span>
newChild1<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'programmer'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parentObj<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span> <span class="token comment">// ['girlfriend', 'money', 'house', 'car', 'programmer']  指向同一个内存的数组</span>
</code></pre></div><h4 id="最简单的-深拷贝"><a href="#最简单的-深拷贝" class="header-anchor">#</a> 最简单的'深拷贝'</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 如果里面存在 正则(空对象)  函数、undefined(丢失) NaN(null)等</span>
<span class="token keyword">function</span> <span class="token function">cloneJSON</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="深拷贝-浅拷贝-递归"><a href="#深拷贝-浅拷贝-递归" class="header-anchor">#</a> 深拷贝：浅拷贝 + 递归</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token punctuation">{</span>b<span class="token operator">:</span><span class="token punctuation">{</span>c<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">deepClone</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 这个方法后面还会用到</span>
  <span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'Object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newObj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      newObj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
obj1<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment">// {a:{b:{c:1}}}</span>

<span class="token keyword">function</span> <span class="token function">isObject</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 可能这样判断对象相对严谨一些吧</span>
  <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[Object Object]'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 数据深度与数据广度比较</span>
<span class="token keyword">function</span> <span class="token function">createData</span> <span class="token punctuation">(</span><span class="token parameter">deep<span class="token punctuation">,</span> breadth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">var</span> target <span class="token operator">=</span> data
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i<span class="token operator">&lt;</span> deep <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> target<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> breadth<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> j
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> target
<span class="token punctuation">}</span>
<span class="token function">createData</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1层深度，每层有3个数据 {data: {0: 0, 1: 1, 2: 2}}</span>
<span class="token function">createData</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3层深度，每层有0个数据 {data: {data: {data: {}}}}</span>

<span class="token comment">// 当deepClone层级很深的话就会栈溢出，但数据的广度不会造成溢出</span>
<span class="token function">deepClone</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Maximum call stack size exceeded</span>
<span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token function">createData</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok 广度不会溢出</span>
</code></pre></div><h4 id="如何处理递归爆栈呢-尾递归-或者是不用递归改为循环"><a href="#如何处理递归爆栈呢-尾递归-或者是不用递归改为循环" class="header-anchor">#</a> 如何处理递归爆栈呢？尾递归？或者是不用递归改为循环？</h4> <h5 id="尾递归-只在严格模式下开启-正常模式是无效的-由于是函数的最后一步操作-所以不需要保留外层函数的调用帧-因为调用位置、内部变量等信息都不会再用到了-只要直接用内层函数的调用帧-取代外层函数的调用帧就可以了。"><a href="#尾递归-只在严格模式下开启-正常模式是无效的-由于是函数的最后一步操作-所以不需要保留外层函数的调用帧-因为调用位置、内部变量等信息都不会再用到了-只要直接用内层函数的调用帧-取代外层函数的调用帧就可以了。" class="header-anchor">#</a> 尾递归（只在严格模式下开启，正常模式是无效的）:由于是函数的最后一步操作，所以不需要保留外层函数的调用帧，因为调用位置、内部变量等信息都不会再用到了，只要直接用内层函数的调用帧，取代外层函数的调用帧就可以了。</h5> <div class="language-Javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">count</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span>total <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> total
  <span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> num <span class="token operator">*</span> total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">// 120</span>
</code></pre></div><h5 id="循环方式-非严格模式下"><a href="#循环方式-非严格模式下" class="header-anchor">#</a> 循环方式(非严格模式下)</h5> <div class="language-Javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    a1<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    a2<span class="token operator">:</span> <span class="token punctuation">{</span>
        b1<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        b2<span class="token operator">:</span> <span class="token punctuation">{</span>
            c1<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 循环遍历</span>
<span class="token keyword">function</span> <span class="token function">cloneLoop</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 栈</span>
    <span class="token keyword">const</span> loopList <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            parent<span class="token operator">:</span> root<span class="token punctuation">,</span>
            key<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> x<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>loopList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 深度优先</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> loopList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> parent <span class="token operator">=</span> node<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> node<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> node<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

        <span class="token comment">// 初始化赋值目标，key为undefined则拷贝到父元素，否则拷贝到子元素</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> key <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果是对象就放到栈里面</span>
                    <span class="token comment">// 下一次循环</span>
                    loopList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        parent<span class="token operator">:</span> res<span class="token punctuation">,</span>
                        key<span class="token operator">:</span> k<span class="token punctuation">,</span>
                        data<span class="token operator">:</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 直接拷贝</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> root<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="循环引用-非严格模式下"><a href="#循环引用-非严格模式下" class="header-anchor">#</a> 循环引用(非严格模式下)：</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 循环引用？</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>a1<span class="token operator">:</span> b<span class="token punctuation">,</span> a2<span class="token operator">:</span> b<span class="token punctuation">}</span>
a<span class="token punctuation">.</span>a1 <span class="token operator">===</span> a<span class="token punctuation">.</span>a2  <span class="token comment">// true</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
c<span class="token punctuation">.</span>a1 <span class="token operator">===</span> c<span class="token punctuation">.</span>a2  <span class="token comment">// false  注意：经过深拷贝以后，丢失了引用关系,成为了两个不同的对象.</span>


<span class="token comment">// 保持引用关系</span>
<span class="token keyword">function</span> <span class="token function">cloneForce</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> uniqueList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用来去重</span>
    <span class="token keyword">let</span> root <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环数组</span>
    <span class="token keyword">const</span> loopList <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            parent<span class="token operator">:</span> root<span class="token punctuation">,</span>
            key<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> x<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>loopList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 深度优先</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> loopList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> parent <span class="token operator">=</span> node<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> node<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> node<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

        <span class="token comment">// 初始化赋值目标，key为undefined则拷贝到父元素，否则拷贝到子元素</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> key <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// =============</span>
        <span class="token comment">// 数据已经存在</span>
        <span class="token keyword">let</span> uniqueData <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>uniqueList<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> uniqueData<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 中断本次循环</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 数据不存在</span>
        <span class="token comment">// 保存源数据，在拷贝数据中对应的引用</span>
        uniqueList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            source<span class="token operator">:</span> data<span class="token punctuation">,</span>
            target<span class="token operator">:</span> res<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 下一次循环</span>
                    loopList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        parent<span class="token operator">:</span> res<span class="token punctuation">,</span>
                        key<span class="token operator">:</span> k<span class="token punctuation">,</span>
                        data<span class="token operator">:</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> root<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>source <span class="token operator">===</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/daily-summary/assets/js/app.ce6a5f7d.js" defer></script><script src="/daily-summary/assets/js/2.e3724b2f.js" defer></script><script src="/daily-summary/assets/js/21.04a772b9.js" defer></script>
  </body>
</html>
